<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>English Q&A Practice</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5faff;
      text-align: center;
      padding: 20px;
    }
    #qaAssistant {
      margin: 20px auto;
      padding: 15px;
      border: 2px solid #2196F3;
      border-radius: 12px;
      background: #e8f4ff;
      max-width: 500px;
    }
    #qaChatBox {
      height: 220px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      background: #fff;
      border-radius: 8px;
      text-align: left;
    }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    #qaAskBtn {
      background: #2196F3;
      color: #fff;
    }
    #qaMicBtn {
      background: #FF5722;
      color: #fff;
    }
    button:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <h1>ü§ñ English Q&A Practice <br> ISC LONG XUY√äN </h1>
  <p>B·∫•m "M√°y h·ªèi c√¢u m·ªõi" ƒë·ªÉ b·∫Øt ƒë·∫ßu luy·ªán t·∫≠p.</p>

  <!-- Khung H·ªèi-ƒê√°p -->
  <div id="qaAssistant">
    <div id="qaChatBox"></div>
    <button id="qaAskBtn">M√°y h·ªèi c√¢u m·ªõi</button>
    <button id="qaMicBtn">üé§ Tr·∫£ l·ªùi</button>
  </div>

  <script>
    const qaChatBox = document.getElementById("qaChatBox");
    const qaAskBtn = document.getElementById("qaAskBtn");
    const qaMicBtn = document.getElementById("qaMicBtn");

    let currentQuestion = "";
    let qaData = [];

    // Load d·ªØ li·ªáu t·ª´ file questions.json
    async function loadQuestions() {
      try {
        const res = await fetch("questions.json");
        qaData = await res.json();
        console.log("‚úÖ Loaded questions:", qaData);
      } catch (err) {
        console.error("‚ùå L·ªói khi load questions.json:", err);
        alert("Kh√¥ng t·∫£i ƒë∆∞·ª£c file questions.json");
      }
    }
    loadQuestions();

    // Th√™m tin nh·∫Øn v√†o khung chat
    function addQAmessage(sender, text) {
      const p = document.createElement("p");
      p.innerHTML = `<strong>${sender}:</strong> ${text}`;
      qaChatBox.appendChild(p);
      qaChatBox.scrollTop = qaChatBox.scrollHeight;
    }

    // M√°y h·ªèi c√¢u m·ªõi
    function askNewQuestion() {
      if (qaData.length === 0) {
        alert("‚ö†Ô∏è Ch∆∞a c√≥ d·ªØ li·ªáu c√¢u h·ªèi.");
        return;
      }
      const item = qaData[Math.floor(Math.random() * qaData.length)];
      currentQuestion = item.q;
      addQAmessage("M√°y", currentQuestion);
      qaSpeakText(currentQuestion);
    }

    // N√∫t "M√°y h·ªèi c√¢u m·ªõi"
    qaAskBtn.addEventListener("click", () => {
      askNewQuestion();
    });

    // === Nh·∫≠n di·ªán gi·ªçng n√≥i ===
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("‚ö†Ô∏è Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i. H√£y d√πng Chrome ho·∫∑c Edge m·ªõi nh·∫•t.");
    }

    let qaRecognition;
    if (SpeechRecognition) {
      qaRecognition = new SpeechRecognition();
      qaRecognition.lang = "en-US";
      qaRecognition.interimResults = false;

      qaMicBtn.addEventListener("click", () => {
        if (!currentQuestion) {
          alert("üëâ H√£y ƒë·ªÉ m√°y h·ªèi tr∆∞·ªõc r·ªìi b·∫°n m·ªõi tr·∫£ l·ªùi nh√©!");
          return;
        }
        qaRecognition.start();
      });

      qaRecognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.toLowerCase(); // √©p v·ªÅ ch·ªØ th∆∞·ªùng
        addQAmessage("B·∫°n", transcript);

        const item = qaData.find(q => q.q === currentQuestion);
        let correct = false;

        if (item) {
          for (let ans of item.answers) {
            if (transcript.includes(ans.toLowerCase())) { // so s√°nh c≈©ng v·ªÅ ch·ªØ th∆∞·ªùng
              correct = true;
              break;
            }
          }
        }

        if (correct) {
          addQAmessage("M√°y", "‚úÖ OK, b·∫°n v∆∞·ª£t qua!");
          qaSpeakText("OK, you passed!");
        } else {
          addQAmessage("M√°y", "‚ùå B·∫°n ƒë√£ tr·∫£ l·ªùi sai.");
          qaSpeakText("Sorry, your answer is incorrect.");
        }

        setTimeout(() => {
          askNewQuestion();
        }, 2000);
      };

      qaRecognition.onerror = (event) => {
        console.error("L·ªói mic:", event.error);
        alert("‚ö†Ô∏è Kh√¥ng nh·∫≠n ƒë∆∞·ª£c t√≠n hi·ªáu t·ª´ micro. Vui l√≤ng ki·ªÉm tra l·∫°i quy·ªÅn micro.");
      };
    }

    // ƒê·ªçc vƒÉn b·∫£n (m√°y n√≥i)
    function qaSpeakText(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-US"; 
      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
